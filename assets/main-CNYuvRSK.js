(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class d{constructor(){this.totalSeconds=0,this.remainingSeconds=0,this.interval=null,this.isPaused=!1,this.callbacks={onTick:[],onComplete:[],onNudge:[]}}start(e){this.interval&&this.stop(),this.totalSeconds=e*60,this.remainingSeconds=this.totalSeconds,this.isPaused=!1,this.interval=setInterval(()=>{this.isPaused||(this.remainingSeconds--,this._triggerCallbacks("onTick",this.getState()),this.remainingSeconds<=0&&(this.stop(),this._triggerCallbacks("onComplete",this.getState())))},1e3)}stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}togglePause(){return this.isPaused=!this.isPaused,this.isPaused}reset(){this.stop(),this.totalSeconds=0,this.remainingSeconds=0,this.isPaused=!1}getState(){return{totalSeconds:this.totalSeconds,remainingSeconds:this.remainingSeconds,elapsedSeconds:this.totalSeconds-this.remainingSeconds,isPaused:this.isPaused,isRunning:this.interval!==null,progress:this.totalSeconds>0?(this.totalSeconds-this.remainingSeconds)/this.totalSeconds*100:0}}isRunning(){return this.interval!==null}on(e,t){this.callbacks[e]&&this.callbacks[e].push(t)}off(e,t){if(this.callbacks[e]){const s=this.callbacks[e].indexOf(t);s>-1&&this.callbacks[e].splice(s,1)}}_triggerCallbacks(e,t){this.callbacks[e]&&this.callbacks[e].forEach(s=>s(t))}}class c{constructor(e,t){this.audioManager=e,this.notificationManager=t,this.nudgeTimes=[],this.completedNudges=new Set}calculateNudgeTimes(e,t){const s=[],i=e*60;if(t.type==="count"){const n=t.value;for(let r=1;r<=n;r++){const o=Math.floor(i*r/(n+1));s.push(o)}}else if(t.type==="percent"){const n=t.value,r=Math.floor(i*n/100);s.push(r)}return this.nudgeTimes=s.sort((n,r)=>n-r),this.completedNudges.clear(),this.nudgeTimes}checkNudges(e,t){const s=[];return this.nudgeTimes.forEach(i=>{e>=i&&!this.completedNudges.has(i)&&(this.completedNudges.add(i),s.push(i),this.audioManager.playChime(),this.notificationManager.showNudge(t))}),s}getNextNudge(e){const t=this.nudgeTimes.filter(s=>s>e&&!this.completedNudges.has(s));if(t.length>0){const s=t[0],i=s-e;return{time:s,timeUntil:i,hasNext:!0}}return{hasNext:!1,allCompleted:this.completedNudges.size>0&&this.completedNudges.size===this.nudgeTimes.length}}getNudgeTimes(){return[...this.nudgeTimes]}getCompletedNudges(){return new Set(this.completedNudges)}reset(){this.nudgeTimes=[],this.completedNudges.clear()}}class u{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)}playChime(){this._playTone(800,.5),setTimeout(()=>this._playTone(1e3,.5),100)}playComplete(){this.playChime(),setTimeout(()=>this.playChime(),300)}_playTone(e,t){const s=this.audioContext.createOscillator(),i=this.audioContext.createGain();s.connect(i),i.connect(this.audioContext.destination),s.frequency.value=e,s.type="sine",i.gain.setValueAtTime(.3,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+t),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+t)}}class h{constructor(){this.requestPermission()}async requestPermission(){"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()}showNudge(e){if("Notification"in window&&Notification.permission==="granted"){const t=Math.floor(e/60),s=e%60,i=`${t}:${s.toString().padStart(2,"0")}`;new Notification("Nudge O'Clock",{body:`Time check! ${i} remaining`,icon:"/favicon.ico"})}}showComplete(){"Notification"in window&&Notification.permission==="granted"&&new Notification("Nudge O'Clock",{body:"Timer complete!",icon:"/favicon.ico"})}isAvailable(){return"Notification"in window&&Notification.permission==="granted"}}class g{constructor(){this.isDarkMode=localStorage.getItem("darkMode")==="true",this.themeIcon=document.getElementById("themeIcon"),this.initialize()}initialize(){this.updateTheme()}toggle(){return this.isDarkMode=!this.isDarkMode,localStorage.setItem("darkMode",this.isDarkMode.toString()),this.updateTheme(),this.isDarkMode}updateTheme(){this.isDarkMode?(document.documentElement.classList.add("dark"),this.themeIcon&&(this.themeIcon.textContent="‚òÄÔ∏è")):(document.documentElement.classList.remove("dark"),this.themeIcon&&(this.themeIcon.textContent="üåô"))}isDark(){return this.isDarkMode}}class m{constructor(){this.isCircular=!1,this.elements=this._getElements(),this.nudgeMarkers=[],this.CIRCLE_RADIUS=80,this.CIRCLE_CIRCUMFERENCE=2*Math.PI*this.CIRCLE_RADIUS}_getElements(){return{progressBar:document.getElementById("progressBar"),progressFill:document.getElementById("progressFill"),nudgeMarkers:document.getElementById("nudgeMarkers"),circularContainer:document.getElementById("circularProgressContainer"),progressCircle:document.getElementById("progressCircle"),circularNudgeMarkers:document.getElementById("circularNudgeMarkers"),toggleBtn:document.getElementById("progressToggleBtn"),toggleIcon:document.getElementById("toggleIcon")}}toggle(){return this.isCircular=!this.isCircular,this._updateToggleButton(),this._updateDisplay(),this.isCircular}_updateToggleButton(){this.isCircular?(this.elements.toggleIcon.textContent="‚óè",this.elements.toggleBtn.innerHTML='<span id="toggleIcon">‚óè</span> Circle'):(this.elements.toggleIcon.textContent="‚ñ¨",this.elements.toggleBtn.innerHTML='<span id="toggleIcon">‚ñ¨</span> Bar'),this.elements.toggleIcon=document.getElementById("toggleIcon")}_updateDisplay(){this.isCircular?(this.elements.progressBar.classList.add("hidden"),this.elements.circularContainer.classList.remove("hidden"),this.elements.circularContainer.classList.add("flex")):(this.elements.progressBar.classList.remove("hidden"),this.elements.circularContainer.classList.add("hidden"),this.elements.circularContainer.classList.remove("flex"))}createNudgeMarkers(e,t){this.nudgeMarkers=e,this._createLinearMarkers(e,t),this._createCircularMarkers(e,t)}_createLinearMarkers(e,t){this.elements.nudgeMarkers.innerHTML="",e.forEach(s=>{const i=document.createElement("div");i.className="nudge-marker",i.dataset.time=s;const n=s/t*100;i.style.left=`${n}%`,this.elements.nudgeMarkers.appendChild(i)})}_createCircularMarkers(e,t){this.elements.circularNudgeMarkers.innerHTML="",e.forEach(s=>{const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","circular-nudge-marker"),i.dataset.time=s;const r=s/t*2*Math.PI,o=100+this.CIRCLE_RADIUS*Math.cos(r),l=100+this.CIRCLE_RADIUS*Math.sin(r);i.setAttribute("cx",o),i.setAttribute("cy",l),i.setAttribute("r","6"),this.elements.circularNudgeMarkers.appendChild(i)})}updateProgress(e,t){this.elements.progressFill.style.width=`${e}%`;const s=this.CIRCLE_CIRCUMFERENCE-e/100*this.CIRCLE_CIRCUMFERENCE;this.elements.progressCircle.style.strokeDashoffset=s,this._updateMarkerStates(t)}_updateMarkerStates(e){document.querySelectorAll(".nudge-marker").forEach(t=>{const s=parseInt(t.dataset.time);e>=s?t.classList.add("completed"):t.classList.remove("completed")}),document.querySelectorAll(".circular-nudge-marker").forEach(t=>{const s=parseInt(t.dataset.time);e>=s?t.classList.add("completed"):t.classList.remove("completed")})}reset(){this.updateProgress(0,0),this.elements.nudgeMarkers.innerHTML="",this.elements.circularNudgeMarkers.innerHTML=""}}class p{constructor(e,t,s,i){this.timer=e,this.nudgeManager=t,this.progressBarManager=s,this.themeManager=i,this.elements=this._getElements(),this._bindEvents(),this._setupTimerCallbacks()}_getElements(){return{timerSetup:document.getElementById("timerSetup"),timerDisplay:document.getElementById("timerDisplay"),nudgeOptions:document.getElementById("nudgeOptions"),minutesInput:document.getElementById("minutes"),nudgeCountRadio:document.getElementById("nudgeCount"),nudgeCountValue:document.getElementById("nudgeCountValue"),nudgePercentRadio:document.getElementById("nudgePercent"),nudgePercentValue:document.getElementById("nudgePercentValue"),startBtn:document.getElementById("startBtn"),pauseBtn:document.getElementById("pauseBtn"),resetBtn:document.getElementById("resetBtn"),themeToggle:document.getElementById("themeToggle"),presetBtns:document.querySelectorAll(".preset-btn"),timeText:document.getElementById("timeText"),statusText:document.getElementById("statusText"),nextNudge:document.getElementById("nextNudge")}}_bindEvents(){this.elements.startBtn.addEventListener("click",()=>this.startTimer()),this.elements.pauseBtn.addEventListener("click",()=>this.togglePause()),this.elements.resetBtn.addEventListener("click",()=>this.resetTimer()),this.elements.themeToggle.addEventListener("click",()=>this.themeManager.toggle()),document.getElementById("progressToggleBtn").addEventListener("click",()=>{this.progressBarManager.toggle(),this._updatePreview()}),this.elements.minutesInput.addEventListener("input",()=>{this._updatePreview(),this._updateActivePreset()}),this.elements.nudgeCountRadio.addEventListener("change",()=>this._updatePreview()),this.elements.nudgeCountValue.addEventListener("input",()=>{this.elements.nudgeCountRadio.checked&&this._updatePreview()}),this.elements.nudgePercentRadio.addEventListener("change",()=>this._updatePreview()),this.elements.nudgePercentValue.addEventListener("input",()=>{this.elements.nudgePercentRadio.checked&&this._updatePreview()}),this.elements.minutesInput.addEventListener("keypress",t=>{t.key==="Enter"&&this.startTimer()}),this.elements.presetBtns.forEach(t=>{t.addEventListener("click",s=>{const i=parseInt(s.target.dataset.minutes);this._setMinutes(i)})})}_setupTimerCallbacks(){this.timer.on("onTick",e=>this._onTimerTick(e)),this.timer.on("onComplete",e=>this._onTimerComplete(e))}startTimer(){const e=parseInt(this.elements.minutesInput.value);if(!e||e<1){alert("Please enter a valid duration");return}const t=this._getNudgeConfig();this.nudgeManager.calculateNudgeTimes(e,t),this.timer.start(e),this._showTimerDisplay(),this.elements.statusText.textContent="Running...",this.elements.pauseBtn.textContent="Pause";const s=this.nudgeManager.getNudgeTimes();this.progressBarManager.createNudgeMarkers(s,e*60)}togglePause(){this.timer.togglePause()?(this.elements.pauseBtn.textContent="Resume",this.elements.statusText.textContent="Paused"):(this.elements.pauseBtn.textContent="Pause",this.elements.statusText.textContent="Running...")}resetTimer(){this.timer.reset(),this.nudgeManager.reset(),this.progressBarManager.reset(),this._showSetupDisplay(),this._updatePreview()}_onTimerTick(e){this._updateTimeDisplay(e.remainingSeconds),this.progressBarManager.updateProgress(e.progress,e.elapsedSeconds),this.nudgeManager.checkNudges(e.elapsedSeconds,e.remainingSeconds).length>0&&this._showNudgeAlert(),this._updateNextNudgeDisplay(e.elapsedSeconds)}_onTimerComplete(e){this.elements.statusText.textContent="Timer Complete!",this._showNudgeAlert()}_showNudgeAlert(){this.elements.timeText.classList.add("nudge-alert"),setTimeout(()=>{this.elements.timeText.classList.remove("nudge-alert")},1500)}_updateTimeDisplay(e){this.elements.timeText.textContent=this._formatTime(e)}_updateNextNudgeDisplay(e){const t=this.nudgeManager.getNextNudge(e);if(t.hasNext){const s=Math.floor(t.timeUntil/60),i=t.timeUntil%60;this.elements.nextNudge.textContent=`Next nudge in ${s}:${i.toString().padStart(2,"0")}`}else t.allCompleted?this.elements.nextNudge.textContent="All nudges completed":this.elements.nextNudge.textContent=""}_getNudgeConfig(){return this.elements.nudgeCountRadio.checked?{type:"count",value:parseInt(this.elements.nudgeCountValue.value)}:{type:"percent",value:parseInt(this.elements.nudgePercentValue.value)}}_showTimerDisplay(){this.elements.nudgeOptions.classList.add("hidden"),this.elements.startBtn.classList.add("hidden"),this.elements.timerDisplay.classList.remove("hidden"),this.elements.timeText.classList.remove("hidden")}_showSetupDisplay(){this.elements.timerDisplay.classList.add("hidden"),this.elements.timeText.classList.add("hidden"),this.elements.nudgeOptions.classList.remove("hidden"),this.elements.startBtn.classList.remove("hidden")}_updatePreview(){const e=parseInt(this.elements.minutesInput.value)||30,t=this._getNudgeConfig();this.nudgeManager.calculateNudgeTimes(e,t);const s=this.nudgeManager.getNudgeTimes();this.progressBarManager.createNudgeMarkers(s,e*60);const i=50,n=e*60*i/100;this.progressBarManager.updateProgress(i,n)}_formatTime(e){const t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}initialize(){this._updatePreview(),this._updateActivePreset()}_setMinutes(e){this.elements.minutesInput.value=e,this._updatePreview(),this._updateActivePreset()}_updateActivePreset(){const e=parseInt(this.elements.minutesInput.value);this.elements.presetBtns.forEach(t=>{parseInt(t.dataset.minutes)===e?t.classList.add("active"):t.classList.remove("active")})}}class f{constructor(){this.audioManager=new u,this.notificationManager=new h,this.themeManager=new g,this.progressBarManager=new m,this.timer=new d,this.nudgeManager=new c(this.audioManager,this.notificationManager),this.uiManager=new p(this.timer,this.nudgeManager,this.progressBarManager,this.themeManager)}initialize(){this.uiManager.initialize()}}document.addEventListener("DOMContentLoaded",()=>{new f().initialize()});
